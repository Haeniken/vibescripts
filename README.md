
# –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
[telegram-alert.sh](#telegram-alert-script)

[rabbitmq_check_consumers](#rabbitmq-consumer-restarter-scripts)

[static-curl-check](#static-curl-check)



# Telegram Alert Script

–°–∫—Ä–∏–ø—Ç `telegram-alert.sh` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram. –û–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ –∑–∞–¥–∞—á–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (`crontab`).

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ó–∞–≥–æ–ª–æ–≤–∫–∏**: –°–∫—Ä–∏–ø—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `(Alert)`
  - –° —Ñ–ª–∞–≥–æ–º `--crontab`: `(Crontab)`
  - –° —Ñ–ª–∞–≥–æ–º `--disaster`: üî• Disaster üî•
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å crontab**: –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á.
- **HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º HTML (–Ω–∞–ø—Ä–∏–º–µ—Ä, `<code>` –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–æ–¥–∞).

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å:
   - Telegram Bot Token.
   - ID —á–∞—Ç–∞ –∏–ª–∏ –∫–∞–Ω–∞–ª–∞, –∫—É–¥–∞ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

2. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –≤–∞—à–µ–º `crontab`:
   ```bash
   ERROR_TELEGRAM_CHAT_ID="-111111111"
   ERROR_TELEGRAM_TOKEN="123124125:AAHyAAaasda_MkeRsasddtmnLpasasdzDV05aBo"
   ```

3. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `telegram-alert.sh` –≤ —É–¥–æ–±–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, `/opt/scripts/`.

4. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
   ```bash
   chmod +x /opt/scripts/telegram-alert.sh
   ```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å crontab
–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ –≤–∞—à `crontab` (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É):

```bash
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–∞
ERROR_TELEGRAM_CHAT_ID="-111111111"
ERROR_TELEGRAM_TOKEN="123124125:AAHyAAaasda_MkeRsasddtmnLpasasdzDV05aBo"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ php-apache
* * * * * [ "$(docker inspect -f '{{.State.Running}}' php-apache 2>/dev/null)" = "true" ] || /opt/scripts/telegram-alert.sh "Container <code>php-apache-clients</code> is dead"
* * * * * [ "$(docker inspect -f '{{.State.Running}}' php-apache 2>/dev/null)" = "true" ] || /opt/scripts/telegram-alert.sh --crontab "Container <code>php-apache-clients</code> is dead"
* * * * * [ "$(docker inspect -f '{{.State.Running}}' php-apache 2>/dev/null)" = "true" ] || /opt/scripts/telegram-alert.sh --disaster "Container <code>php-apache-clients</code> is dead"
```

## –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
```
(Alert) hostname
Container <code>php-apache-clients</code> is dead
```

### –° —Ñ–ª–∞–≥–æ–º `--crontab`
```
(Crontab) hostname
Container <code>php-apache-clients</code> is dead
```

### –° —Ñ–ª–∞–≥–æ–º `--disaster`
```
üî• Disaster üî• hostname
Container <code>php-apache-clients</code> is dead
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `curl`: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API Telegram.
- `bash`: –°–∫—Ä–∏–ø—Ç –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ Bash.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è              | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
|-------------------------|-----------------------------------------------|
| `ERROR_TELEGRAM_CHAT_ID`| ID —á–∞—Ç–∞ –∏–ª–∏ –∫–∞–Ω–∞–ª–∞ Telegram                   |
| `ERROR_TELEGRAM_TOKEN`  | –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram-–±–æ—Ç–∞                    |

–≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ª–∏–±–æ –≤ `crontab`, –ª–∏–±–æ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.





# RabbitMQ Consumer Restarter Scripts

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∞ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π RabbitMQ:

1. **`consumer_restarter.sh`**: –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π RabbitMQ –∏ –∏—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
2. **`check_rabbitmq_consumers.sh`**: –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram —á–µ—Ä–µ–∑ `telegram-alert.sh`.


## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π RabbitMQ.
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫**: –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π —Ä–∞–≤–Ω–æ 0, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Docker –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è.
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏–ª–∏ —É—Å–ø–µ—à–Ω–æ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ `telegram-alert.sh`.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥-—Ñ–∞–π–ª –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –æ–±–∞ —Å–∫—Ä–∏–ø—Ç–∞ (`consumer_restarter.sh` –∏ `check_rabbitmq_consumers.sh`) –≤ —É–¥–æ–±–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
   ```bash
   /opt/scripts/queue/
   ```

2. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
   ```bash
   chmod +x /opt/scripts/queue/consumer_restarter.sh
   chmod +x /opt/scripts/queue/check_rabbitmq_consumers.sh
   ```

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª [–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏](#–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)).

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `consumer_restarter.sh`

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª `.env` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```bash
RABBITMQ_DEFAULT_USER=guest
RABBITMQ_DEFAULT_PASS=guest
RABBITMQ_MANAGEMENT_PORT=15672
```

–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É `.env` —É–∫–∞–∑–∞–Ω –≤ —Å–∫—Ä–∏–ø—Ç–µ:
```bash
ENV_FILE="/opt/containers/queue/.env"
```

–ï—Å–ª–∏ –ø—É—Ç—å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, –æ–±–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ —Å–∫—Ä–∏–ø—Ç–µ.

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –æ—á–µ—Ä–µ–¥—å `default`. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–≤ –∏ –∏–∑–º–µ–Ω–∏–≤ –º–∞—Å—Å–∏–≤ `QUEUES`:
```bash
QUEUES=(
    "default"
    "another_queue"
)
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–î–ª—è —Ä–∞–±–æ—Ç—ã `check_rabbitmq_consumers.sh` —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç `telegram-alert.sh`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏ `/opt/scripts/telegram-alert.sh`.

–¢–∞–∫–∂–µ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Telegram:
```bash
ERROR_TELEGRAM_CHAT_ID="-111111111"
ERROR_TELEGRAM_TOKEN="123124125:AAHyAAaasda_MkeRsasddtmnLpasasdzDV05aBo"
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### `consumer_restarter.sh`

#### –û–ø–∏—Å–∞–Ω–∏–µ
–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π –æ—á–µ—Ä–µ–¥–∏ RabbitMQ. –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π —Ä–∞–≤–Ω–æ 0, –æ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Docker.

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é:
```bash
/opt/scripts/queue/consumer_restarter.sh
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ `crontab` –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
* * * * * /opt/scripts/queue/consumer_restarter.sh
```

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ö —á–µ—Ä–µ–∑ API RabbitMQ.
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π –æ—á–µ—Ä–µ–¥–∏.
3. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Docker.

---

### `check_rabbitmq_consumers.sh`

#### –û–ø–∏—Å–∞–Ω–∏–µ
–°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ `consumer_restarter.sh` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞.

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ `crontab` –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
* * * * * /opt/scripts/queue/check_rabbitmq_consumers.sh
```

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
1. –ó–∞–ø—É—Å–∫–∞–µ—Ç `consumer_restarter.sh` –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –≤—ã—Ö–æ–¥–Ω–æ–π –∫–æ–¥.
2. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –æ—à–∏–±–∫–∏ –Ω–∞ —É—Å–ø–µ—Ö), –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≤ —Ñ–∞–π–ª `/tmp/rabbitmq_consumer_status`.

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥-—Ñ–∞–π–ª:
```bash
/var/log/consumer_restarter.log
```

–ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏:
```
2023-10-01 12:00:00 - –û—á–µ—Ä–µ–¥—å default: 0 –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤
2023-10-01 12:00:01 - –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 0 –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤ –¥–ª—è default. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é...
2023-10-01 12:00:10 - –ö–æ–Ω—Å—å—é–º–µ—Ä—ã –¥–ª—è default —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã
```

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–æ–≤ —Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

- `curl`: –î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API RabbitMQ.
- `jq`: –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON-–¥–∞–Ω–Ω—ã—Ö.
- `bash`: –°–∫—Ä–∏–ø—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ Bash.

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:
```bash
sudo apt update
sudo apt install curl jq -y
```





# Static Curl Check

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∏–ª–∏ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ `static3`) –≤ HTML-–∫–æ–¥–µ –≥—Ä—É–ø–ø—ã —Å–∞–π—Ç–æ–≤. –û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π –¥–æ–º–µ–Ω –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–∫–∞—Ö.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–§–∞–π–ª —Å –¥–æ–º–µ–Ω–∞–º–∏**: –°–∫—Ä–∏–ø—Ç —á–∏—Ç–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞ `static-curl-check_domains.csv`. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–¥–∏–Ω –¥–æ–º–µ–Ω. –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `#`), –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞**: –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª—è–µ—Ç –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π —Å–ª—ç—à (`/`) –∏–∑ URL –¥–æ–º–µ–Ω–∞, –µ—Å–ª–∏ –æ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

3. **–ü–æ–∏—Å–∫ —Å—Å—ã–ª–∫–∏**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è HTTP-–∑–∞–ø—Ä–æ—Å –∫ –µ–≥–æ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (`https://<–¥–æ–º–µ–Ω>`). –í –æ—Ç–≤–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ (–≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ ‚Äî `static3`).

4. **–í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**:
   - –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞, —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç.
   - –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–∫—Ä–∏–ø—Ç —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ –¥–æ–º–µ–Ω "—á–∏—Å—Ç".

5. **–¢–∞–π–º–∞—É—Ç**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç –≤ 5 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∑–∞–≤–∏—Å–∞–Ω–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–æ–º–µ–Ω–∞.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ —Å –¥–æ–º–µ–Ω–∞–º–∏
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `static-curl-check_domains.csv` –∏ —É–∫–∞–∂–∏—Ç–µ –≤ –Ω–µ–º –¥–æ–º–µ–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏. –ù–∞–ø—Ä–∏–º–µ—Ä:
```
https://example.com
https://test.com
# –≠—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
https://another-example.com/
```

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–∂–¥—ã–π –¥–æ–º–µ–Ω —É–∫–∞–∑–∞–Ω –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ.
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `#`) –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

### 2. –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
```bash
./static-curl-check.sh
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
Checking: https://example.com
https://example.com is OK
-----------------------------
Checking: https://test.com
ERROR for https://test.com
<script src="https://static3.example.com/script.js"></script>
-----------------------------
Checking: https://another-example.com
https://another-example.com is OK
-----------------------------
```

### 3. –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ï—Å–ª–∏ –¥–æ–º–µ–Ω "—á–∏—Å—Ç", –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `<–¥–æ–º–µ–Ω> is OK`.
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ `static3`, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `ERROR for <–¥–æ–º–µ–Ω>` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–∫–∞—Ç—å –¥—Ä—É–≥—É—é —Å—Å—ã–ª–∫—É, –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Å `grep` –≤ —Å–∫—Ä–∏–ø—Ç–µ:
```bash
result=$(curl -s --max-time 5 "https://$domain" | grep "static3")
```
–ó–∞–º–µ–Ω–∏—Ç–µ `"static3"` –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- `curl`: –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.
- `grep`: –î–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ –æ—Ç–≤–µ—Ç–µ.

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–∏ —É—Ç–∏–ª–∏—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ. –ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏—Ö:
```bash
sudo apt update
sudo apt install curl grep -y
```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ü—Ä–æ—Ç–æ–∫–æ–ª**: –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Ç–æ–∫–æ–ª `https`. –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ–º–µ–Ω—ã –ø–æ `http`, –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
   ```bash
   result=$(curl -s --max-time 5 "http://$domain" | grep "static3")
   ```

2. **–¢–∞–π–º–∞—É—Ç**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç –≤ 5 —Å–µ–∫—É–Ω–¥. –ï—Å–ª–∏ —ç—Ç–æ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∏–ª–∏ –º–Ω–æ–≥–æ, –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `--max-time`.

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ —Ñ–∞–π–ª –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:
   ```bash
   ./static-curl-check.sh > results.log
   ```

---

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∏—Å–∫–∞ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–æ–º–µ–Ω–æ–≤, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏ –∫—Ä—É–ø–Ω—ã—Ö –≥—Ä—É–ø–ø —Å–∞–π—Ç–æ–≤.
